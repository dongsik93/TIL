# 제9강 비트코인 블록체인 합의 프로토콜2





- ##### 블록체인 분기와 동기화

  -  A1 블록상에서 다음 브록을 채굴하는 채굴자들의 해시파워가 높으면 A1 블록을 부모 블록으로 하는 B1 블록이 생성될 가능성이 높음
  - 이후 채굴자들이 B1블록을 부모 블록으로 다음 블록 채굴 활동 -> 블록체인은 500,001-A1-B1의 메인체인으로 수렴

- ##### 블록체인 동기화

  - 합의 공격(51% 공격)
    - 공격자가 자신의 이중 지불 거래가 포함된 블록을 메인 체인이 아닌 공격 대상의 정상 거래가 포함된 블록의 이전 블록에 연결하여 브랜치를 만들고, 이후  충분한 해시율로 연속적으로 블록 브랜치에 역녈하여 최종적으로 브랜치를 메인 메인으로 교체하는 공격
    - 현실적으로는 51% 이상의 해시율을 가진 공격자가 존재하기가 어렵고, 또한 공격 과정에서 블록체인 변화 과정이 추적될 수 있기 때문에 실제도 일어나기 어려우는 공격
    - 만약 51% 공격으로 비트코인의 신뢰가 훼손되어 참여자가 이탈하고 그에 따라 비트코인의 가치가 하락했을 때, 가장 치멱적인 손실을 입는 참여자는 51% 해시율을 투자한 공격자 자신이 될 것임
  - 합의 규칙 변경
    - 소프트 포크
      - 호환성을 유지하면서 이루어지는 합의 규칙 변경
    - 하드 포크
      - 기존 비트코인과의 호환서 결여를 무름쓰고 이루어지는 합의 규칙 변경
      - ex) 블록 크기 변경 - 비트코인 캐시


- ##### 비트코인의 분산 합의 정책

  - 인센티브 정책(incentive policy)
    - 최종적으로 승인된 블록을 생성한 채굴자는 블록보상과 거래 수수료를 인센티브로 지급받는다
    - 중도에 블록 승인이 취소되면 블록 인센티브도 취소된다

- ##### 비트코인 합의 알고리즘

  - 묵시적인 합의 알고리즘 채택
    - 채굴자가 최선을 다해서 합의 규칙에 따라 채굴 작업에 열중하다 보면 블록 승인의 합의에 도달하고, 블록체인이 충분히 동기화된 상태로 유지되어 이익이 되는 구조
    - 합의 규칙을 따르지 않으면 자신에게 손해가되는 구조

- ##### 비트코인 합의 문제의 어려움

  - 명시적인 합의 메커니즘 적용의 어려움
    - 익명성
    - Sybil 공격 가능성
    - P2P 네트워크의 불안정성





# 제 10강 이더리움과 스마트계약1



- ##### 이더리움 출현

  - Vitalik Buterin의 이더리움
    - 차세대 스마트 계약과 비집중화된 응용 플랫폼

- 이더리움 현황

  - 현황 및 계획
    - Homestead 버전의 시스템이 출시되어 2017년까지 현장에서 운영
    - Metropolis(Byzantium)버전 2017년 10월 출시
    - Serenity 버전의 시스템 출시 예정
    - Serneity  버전에서는 비트코인과 융사한 작업증명 기반의 현재의 채굴과 합의 알고리즘이 소유 증명 기반으로 변경 예정

- ##### 이더리움 목표

  - 이더리움 개발 목표
    - 어떤 형태의 비즈니스 계약도 프로그램으로 작성하여 블록체인에 저장하고, 관련 참여자들이 적절하게 계약 프로그램을 실행하고, 실행 결과를 블록체인에 저장할 수 있는 가상 머신 개발
    - 스마트 계약 저장과 실행을 위한 World Computer 개발

- ##### 스마트 계약

  - 스마트 계약

    - 외부 참여자에 의해 작성되어 블록체인에 저장된 실행 가능한 프로그램

    - 자체 계좌(Contract Account)를 가지고, 실행 결과를 블록체인에 저장할 수 있으며, 관련 외부 참여자와 거래(transaction)를 통해 다양한 형태의 통신 가능

    - ##### 이더리움 거래의 당사자로 참여(내부 참여자)

    - ex) 에스크로(Escrow) 프로그램

      - 구매자는 스마트 계약과의 거래 실행을 통해 스마트 계약의 계좌로 구매대금 지불
      - 스마트 계약은 판매자에게 지불 사실 통보
      - 판매자는 상품을 전달한 후 스마트 계약에게 통보
      - 스마트 계약은 판매자 계좌로 구매대금 이체

    - ex) DAO(Distributed Autonomous Organization)

      - 블록체인 상에 스마트 계약으로 작성된 벤쳐 투자 회사
      - 2016년 이더리움 재단에서 Solidity로 작성하고 운영(11.5M ETH 규모)
      - 투자자 모집, 지분에 따른 권한 배분, 투자금 회수, 투자 프로젝트 결정 등 조직의 모든 운영을 스마트계약 프로그램과 투자자의 거래를 통해 수행

  - 스마트 계약의 작성

    - 외부 참여자가 작성
    - 스마트 계약 생성 거래를 통해 블록체인에 저장

  - 스마트 계약의 실행

    - 외부 참여자가 스마트 계약과의 를  

- ##### 이더리움 계좌 자료 구조

  - 계좌 자료구조
    - 넌스
    - 잔고
    - 저장소루트
    - 코드해
  - EOA의 주소 추론 과정
    - A = keccak256(K)
    - keccak256 : NIST가 HSA256 후속 표준인 HSA3을 만들기 위해 제안된 해시 알고리즘
  - CA의 주소 추론 과정
    - Aca = kecca256(Aeoa+nonce)

- ##### 